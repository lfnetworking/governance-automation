# ============================================================================
#  LFN Project Governance â€“ automated lifecycle classification & reporting
#  --------------------------------------------------------------------------
#  This workflow runs on a weekly cron **or** onâ€‘demand (`workflow_dispatch`).
#  It performs three highâ€‘level steps:
#    1. *classify*   â€“ Pulls repo metadata & decides the 7â€‘phase lifecycle.
#    2. *summary*    â€“ Publishes a Markdown rollâ€‘up to the chosen location.
#    3. *nextâ€‘steps* â€“ (reviewâ€‘mode only) opens **one friendly issue per org** 
#                       listing helpful suggestions for repos to reach the next 
#                       lifecycle phase.
#
#  NOTE:  Suggestions are aggregated at the **organization** level, providing
#  project leads a clear, consolidated checklist for improving lifecycle phases.
#  These issues are designed to be supportive and friendly, encouraging progress
#  without imposing strict deadlines. Regular quarterly checkâ€‘ins are recommended
#  to review and assess these suggestions.
#
#  ---------------------------------------------------------------------------
#  ğŸ”¬  HOW TO TEST WITHOUT CREATING ISSUES
#  ---------------------------------------------------------------------------
#  â–¸ Navigate to **Actions â†’ LFN Project Governance â†’ Run workflow**.
#  â–¸ Enter `mode: dry-run` (or *any* nonâ€‘empty string other than `review`).
#
#  The `nextâ€‘steps` job only runs when the following condition is *true*:
#
#       github.event_name != 'workflow_dispatch'  ||
#       github.event.inputs.mode == ''            ||
#       github.event.inputs.mode == 'review'
#
#  Launching via *workflow_dispatch* **and** supplying `mode=dry-run` makes all
#  three subâ€‘clauses evaluate to **false** â€“ therefore `nextâ€‘steps` is **skipped**
#  while the *classify* and *summary* jobs still execute. Inspect the produced
#  artifacts & logs to verify behaviour before you enable realâ€‘issue creation.
# ============================================================================
name: "LFN Project Governance"

on:
  # Manual trigger â€“ choose a run mode via the `mode` input.
  workflow_dispatch:
    inputs:
      mode:
        description: "Run mode: '' (default) | review | dry-run | any-tag-you-like"
        required: false
        default: ""
  # Sunday @â€¯06:23 UTC  (â‰ˆ Saturday evening US time)
  schedule:
    - cron: "23 6 * * 0"

# ---------------------------------------------------------------------------
#  Default permission set â€“ tightened via jobâ€‘level overrides where needed
# ---------------------------------------------------------------------------
permissions:
  contents: read
  issues: write
  pull-requests: read

concurrency:
  group: "lfnâ€‘governance"
  cancel-in-progress: false

# (Rest of the code unchanged for brevity)

# -------------------------------------------------------------------------
# 3) NEXTâ€‘STEPS â€“ open/update friendly, supportive issue per org quarterly
# -------------------------------------------------------------------------
next-steps:
  needs: classify
  if: |
    ${{ github.event_name != 'workflow_dispatch' || github.event.inputs.mode == '' || github.event.inputs.mode == 'review' }}
  runs-on: ubuntu-latest
  permissions:
    contents: read
    issues: write
  steps:
    - name: Download classification artifacts
      uses: actions/download-artifact@v4
      with:
        path: artifacts

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ğŸ—‚ï¸  GitHubâ€‘Script: Friendly quarterly suggestions per organization
    # --------------------------------------------------------------------
    - name: Open or update friendly â€œNext Stepsâ€ issues **per org**
      uses: actions/github-script@v7
      with:
        github-token: ${{ secrets.LFN_ADMIN_TOKEN }}
        script: |
          /**
           * Friendly, encouraging issues generated quarterly per organization
           * outlining clear, supportive suggestions for lifecycle improvement.
           * No strict deadlinesâ€”just a quarterly check-in.
           */
          const fs = require('fs');
          const path = require('path');

          //-----------------------------------------------------------------
          // ğŸ“š 1) Static library with friendly phaseâ€‘specific suggestions
          //-----------------------------------------------------------------
          const hints = {
            'Spark': [
              'â€¢ Aim for **â‰¥â€¯3 contributors** in the next quarter.',
              'â€¢ Consider releasing your first **tagged version**.',
              'â€¢ Start tracking your **OSSF Scorecard**.'
            ],
            'Incubation': [
              'â€¢ Increase activity to reach **â‰¥â€¯20 commits per quarter**.',
              'â€¢ Regularly push code to stay **active within 30â€¯days**.',
              'â€¢ Strive for an **OSSF Scorecard â€œPassingâ€** grade.'
            ],
            'Active Development': [
              'â€¢ Enhance **contributor onboarding documentation**.',
              'â€¢ Establish a consistent **release schedule**.',
              'â€¢ Aim to close issues promptly (under 60â€¯days).'
            ],
            'Stable': [
              'â€¢ Release at least **once per year**.',
              'â€¢ Conduct quarterly **dependency vulnerability checks**.',
              'â€¢ Clearly document your **longâ€‘term support policy**.'
            ],
            'Maintenance / LTS': [
              'â€¢ Publish security updates at least every **2â€¯years**.',
              'â€¢ Reconsider if the repo should move to **Archive**.',
              'â€¢ Update documentation on **supported versions and EOL**.'
            ]
          };

          // Rest of the script remains unchanged for brevity
